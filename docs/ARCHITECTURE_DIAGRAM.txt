POLITICIAN TRADING TRACKER - COMPLETE ARCHITECTURE DIAGRAM
===========================================================

ENTRY POINTS & ACTION TRIGGERS
==============================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STREAMLIT WEB INTERFACE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  Page 1: Data Collection (pages/1_ğŸ“¥_Data_Collection.py)           â”‚
â”‚  â”œâ”€ [ğŸš€ Start Collection] â†’ run_full_collection()                  â”‚
â”‚  â””â”€ [ğŸ”„ Backfill Tickers] â†’ ticker extraction & DB updates         â”‚
â”‚                                                                       â”‚
â”‚  Page 5: Scheduled Jobs (pages/5_â°_Scheduled_Jobs.py)              â”‚
â”‚  â”œâ”€ [â• Add Interval Job] â†’ scheduler.add_interval_job()           â”‚
â”‚  â”œâ”€ [â• Add Cron Job] â†’ scheduler.add_cron_job()                   â”‚
â”‚  â”œâ”€ [â–¶ï¸ Run Now] â†’ scheduler.run_job_now()                         â”‚
â”‚  â”œâ”€ [â¸ï¸ Pause] â†’ scheduler.pause_job()                             â”‚
â”‚  â”œâ”€ [â–¶ï¸ Resume] â†’ scheduler.resume_job()                           â”‚
â”‚  â””â”€ [ğŸ—‘ï¸ Remove] â†’ scheduler.remove_job()                           â”‚
â”‚                                                                       â”‚
â”‚  Main App (app.py)                                                   â”‚
â”‚  â””â”€ App Startup â†’ get_scheduler() â†’ job recovery                   â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  LOGGER SYSTEM       â”‚
                        â”‚  (PTTLogger)         â”‚
                        â”‚  per-module loggers  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Dual Output System          â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ â€¢ Console (ANSI colored)     â”‚
                    â”‚ â€¢ File (JSON structured)     â”‚
                    â”‚   logs/YYYY-MM-DD.log        â”‚
                    â”‚   logs/latest.log (symlink)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DATA COLLECTION WORKFLOW
========================

              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Data Collection Workflow        â”‚
              â”‚ (src/politician_trading/workflow) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  _collect_us_congress_data()         â”‚
              â”‚  _collect_eu_parliament_data()       â”‚
              â”‚  _collect_uk_parliament_data()       â”‚
              â”‚  _collect_california_data()          â”‚
              â”‚  _collect_us_states_data()           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  For each disclosure:                â”‚
              â”‚  â€¢ Extract politician info           â”‚
              â”‚  â€¢ Lookup/create politician record   â”‚
              â”‚  â€¢ Extract ticker from asset name    â”‚
              â”‚  â€¢ Insert/update trading disclosure  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Return DataPullJob with metrics:    â”‚
              â”‚  â€¢ records_found                     â”‚
              â”‚  â€¢ records_processed                 â”‚
              â”‚  â€¢ records_new                       â”‚
              â”‚  â€¢ records_updated                   â”‚
              â”‚  â€¢ records_failed                    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SCHEDULER ARCHITECTURE (APScheduler)
====================================

          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  SchedulerManager (Singleton)  â”‚
          â”‚  src/politician_trading/        â”‚
          â”‚  scheduler/manager.py           â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  On Initialization:                     â”‚
      â”‚  1. Create BackgroundScheduler          â”‚
      â”‚  2. Configure job defaults              â”‚
      â”‚  3. Initialize JobHistory               â”‚
      â”‚  4. Start scheduler                     â”‚
      â”‚  5. Load jobs from DB                   â”‚
      â”‚  6. Recover missed jobs                 â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Schedule Types:                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ Interval: Every N seconds     â”‚
    â”‚ â€¢ Cron: Schedule-based (UTC)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Trigger Events:                 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ Scheduled time reached         â”‚
    â”‚ â€¢ Manual "Run Now" button        â”‚
    â”‚ â€¢ App startup recovery           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Job Execution Flow:                 â”‚
    â”‚  _create_job_wrapper()               â”‚
    â”‚  â”œâ”€ Create LogCaptureHandler         â”‚
    â”‚  â”œâ”€ Add to root logger               â”‚
    â”‚  â”œâ”€ Execute job function             â”‚
    â”‚  â”‚  (data_collection_job,            â”‚
    â”‚  â”‚   ticker_backfill_job)            â”‚
    â”‚  â”œâ”€ Capture logs                     â”‚
    â”‚  â”œâ”€ Record in JobHistory             â”‚
    â”‚  â””â”€ Persist to DB                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DATABASE ARCHITECTURE
=====================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE DATABASE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  CORE DATA TABLES:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   politicians    â”‚  â”‚ trading_          â”‚  â”‚ data_        â”‚   â”‚
â”‚  â”‚                  â”‚  â”‚ disclosures       â”‚  â”‚ sources      â”‚   â”‚
â”‚  â”‚ â€¢ id             â”‚  â”‚                   â”‚  â”‚              â”‚   â”‚
â”‚  â”‚ â€¢ first_name     â”‚  â”‚ â€¢ id              â”‚  â”‚ â€¢ id         â”‚   â”‚
â”‚  â”‚ â€¢ last_name      â”‚  â”‚ â€¢ politician_id   â”‚  â”‚ â€¢ name       â”‚   â”‚
â”‚  â”‚ â€¢ role           â”‚  â”‚ â€¢ transaction_    â”‚  â”‚ â€¢ url        â”‚   â”‚
â”‚  â”‚ â€¢ party          â”‚  â”‚   date            â”‚  â”‚ â€¢ is_active  â”‚   â”‚
â”‚  â”‚ â€¢ state_country  â”‚  â”‚ â€¢ asset_ticker    â”‚  â”‚ â€¢ last_pull  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ asset_type      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â–²              â”‚ â€¢ amount_range_   â”‚                     â”‚
â”‚         â”‚              â”‚   min/max         â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â€¢ status          â”‚                     â”‚
â”‚            (references)â”‚ â€¢ source_url      â”‚                     â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                   â”‚
â”‚  JOB TRACKING TABLES:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  scheduled_jobs        â”‚  â”‚  job_executions              â”‚   â”‚
â”‚  â”‚                        â”‚  â”‚                              â”‚   â”‚
â”‚  â”‚ â€¢ id                   â”‚  â”‚ â€¢ id                         â”‚   â”‚
â”‚  â”‚ â€¢ job_id (UNIQUE)      â”‚  â”‚ â€¢ job_id (â†’scheduled_jobs)   â”‚   â”‚
â”‚  â”‚ â€¢ job_name             â”‚  â”‚ â€¢ status (success/failed)    â”‚   â”‚
â”‚  â”‚ â€¢ job_function         â”‚  â”‚ â€¢ started_at                 â”‚   â”‚
â”‚  â”‚ â€¢ schedule_type        â”‚  â”‚ â€¢ completed_at               â”‚   â”‚
â”‚  â”‚ â€¢ schedule_value       â”‚  â”‚ â€¢ duration_seconds           â”‚   â”‚
â”‚  â”‚ â€¢ enabled              â”‚  â”‚ â€¢ error_message              â”‚   â”‚
â”‚  â”‚ â€¢ last_successful_run  â”‚  â”‚ â€¢ logs (full output)         â”‚   â”‚
â”‚  â”‚ â€¢ next_scheduled_run   â”‚  â”‚ â€¢ metadata                   â”‚   â”‚
â”‚  â”‚ â€¢ consecutive_failures â”‚  â”‚ â€¢ created_at                 â”‚   â”‚
â”‚  â”‚ â€¢ max_consecutive_     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚   failures             â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚               â”‚                                                  â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                                              â”‚   â”‚
â”‚  VIEWS:                                                      â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚job_execution_summary â”‚  â”‚scheduled_jobs_status         â”‚ â”‚   â”‚
â”‚  â”‚                      â”‚  â”‚                              â”‚ â”‚   â”‚
â”‚  â”‚ â€¢ job_id            â”‚  â”‚ â€¢ job status (disabled,      â”‚ â”‚   â”‚
â”‚  â”‚ â€¢ total_executions  â”‚  â”‚   overdue, scheduled, etc)  â”‚ â”‚   â”‚
â”‚  â”‚ â€¢ successful_count  â”‚  â”‚ â€¢ last_execution_status     â”‚ â”‚   â”‚
â”‚  â”‚ â€¢ failed_count      â”‚  â”‚ â€¢ last_execution_duration  â”‚ â”‚   â”‚
â”‚  â”‚ â€¢ avg_duration      â”‚  â”‚ â€¢ last_execution_error     â”‚ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚                                                              â”‚   â”‚
â”‚  STORED PROCEDURES:                                          â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚ â€¢ update_job_after_execution()                       â”‚   â”‚   â”‚
â”‚  â”‚ â€¢ calculate_next_run()                               â”‚   â”‚   â”‚
â”‚  â”‚ â€¢ cleanup_old_job_executions()                       â”‚   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚                                                             â”‚   â”‚
â”‚  SECURITY (RLS):                                           â”‚   â”‚
â”‚  â”œâ”€ Service role: Full access                            â”‚   â”‚
â”‚  â”œâ”€ Authenticated: Full access                           â”‚   â”‚
â”‚  â””â”€ Anonymous: Read-only                                 â”‚   â”‚
â”‚                                                             â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


JOB EXECUTION STATE MACHINE
===========================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PENDING        â”‚
â”‚ (Initial state) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RUNNING        â”‚  (once: just started)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      â”‚
    â†“                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUCCESS      â”‚   â”‚  FAILED      â”‚
â”‚ âœ“ Reset      â”‚   â”‚ â€¢ Increment  â”‚
â”‚   failures   â”‚   â”‚   failures   â”‚
â”‚ âœ“ Save time  â”‚   â”‚ â€¢ Save error â”‚
â”‚ âœ“ Update DB  â”‚   â”‚ âœ“ Save time  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ âœ“ Update DB  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                            â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                   â”‚
              (< max)             (>= max)
                   â”‚                   â”‚
                   â†“                   â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  RETRY WAIT  â”‚   â”‚ DISABLED     â”‚
           â”‚  â° Waiting  â”‚   â”‚ âŒ Auto-off  â”‚
           â”‚    for next  â”‚   â”‚    (manual   â”‚
           â”‚    schedule  â”‚   â”‚     re-en)   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ERROR HANDLING FLOW
===================

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Action Triggered       â”‚
        â”‚  (button or schedule)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Try Execute            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                â”‚
    â”‚  Success                 Error â”‚
    â”‚    â†“                      â†“    â”‚
    â”‚  Log OK              Log Error â”‚
    â”‚  Record success      Record errâ”‚
    â”‚  âœ“ Result            âœ“ Message â”‚
    â”‚  âœ“ Duration          âœ“ Details â”‚
    â”‚  âœ“ Metrics           âœ“ Stack   â”‚
    â”‚                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database Persistence    â”‚
    â”‚ â€¢ job_executions table  â”‚
    â”‚ â€¢ action_logs table     â”‚
    â”‚ â€¢ logs file system      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


LOGGING FLOW
============

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application Code                    â”‚
â”‚  logger.info("message", metadata={..})â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  PTTLogger Instance â”‚
      â”‚  (per-module)       â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Handler Selection   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
         â†“         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚CONSOLE â”‚  â”‚ FILE         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚Colored â”‚  â”‚JSON Format   â”‚
    â”‚(ANSI)  â”‚  â”‚Structured    â”‚
    â”‚stdout  â”‚  â”‚logs/YYYY-... â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


RECOMMENDED: ACTION LOGS TABLE
==============================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           action_logs (Recommended)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (UUID)                                    â”‚
â”‚ â€¢ action_type (VARCHAR)                        â”‚
â”‚   â”œâ”€ 'data_collection_start'                   â”‚
â”‚   â”œâ”€ 'data_collection_complete'                â”‚
â”‚   â”œâ”€ 'job_created'                             â”‚
â”‚   â”œâ”€ 'job_executed'                            â”‚
â”‚   â”œâ”€ 'job_paused'                              â”‚
â”‚   â”œâ”€ 'job_resumed'                             â”‚
â”‚   â”œâ”€ 'job_removed'                             â”‚
â”‚   â””â”€ 'job_recovered'                           â”‚
â”‚ â€¢ user_id (VARCHAR)                            â”‚
â”‚ â€¢ action_timestamp (TIMESTAMPTZ)               â”‚
â”‚ â€¢ action_details (JSONB)                       â”‚
â”‚ â€¢ job_id (VARCHAR) - if job-related            â”‚
â”‚ â€¢ job_execution_id (UUID) - if exec-related    â”‚
â”‚ â€¢ status (VARCHAR)                             â”‚
â”‚   â”œâ”€ 'initiated'                               â”‚
â”‚   â”œâ”€ 'in_progress'                             â”‚
â”‚   â”œâ”€ 'completed'                               â”‚
â”‚   â””â”€ 'failed'                                  â”‚
â”‚ â€¢ result_message (TEXT)                        â”‚
â”‚ â€¢ error_message (TEXT)                         â”‚
â”‚ â€¢ source (VARCHAR)                             â”‚
â”‚   â”œâ”€ 'ui_button'                               â”‚
â”‚   â”œâ”€ 'scheduled_job'                           â”‚
â”‚   â””â”€ 'recovery'                                â”‚
â”‚ â€¢ request_duration_seconds (DECIMAL)           â”‚
â”‚ â€¢ created_at / updated_at (TIMESTAMPTZ)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


INTEGRATION POINTS FOR ACTION LOGGING
======================================

1. Data Collection Page (pages/1_ğŸ“¥_Data_Collection.py)
   Line 119 â†’ Trigger log_action("data_collection_start", ...)
   Line 249 â†’ Trigger log_action("data_collection_complete", ...)

2. Scheduled Jobs Manager (src/politician_trading/scheduler/manager.py)
   Line 233 â†’ Trigger log_action("interval_job_created", ...)
   Line 340 â†’ Trigger log_action("cron_job_created", ...)
   Line 360 â†’ Trigger log_action("job_executed", ...)
   Line 642 â†’ Trigger log_action("job_removed", ...)
   Line 657 â†’ Trigger log_action("job_paused", ...)
   Line 670 â†’ Trigger log_action("job_resumed", ...)
   Line 783 â†’ Trigger log_action("job_recovered", ...)

3. Scheduled Jobs UI (pages/5_â°_Scheduled_Jobs.py)
   Line 141 â†’ Trigger log_action("resume_job_requested", ...)
   Line 148 â†’ Trigger log_action("pause_job_requested", ...)
   Line 155 â†’ Trigger log_action("run_now_requested", ...)
   Line 162 â†’ Trigger log_action("remove_job_requested", ...)


KEY METRICS & MONITORING
========================

Real-time Metrics (via views):
  â€¢ job_execution_summary
    - Total executions per job
    - Success rate
    - Average duration
    - Latest execution time

  â€¢ scheduled_jobs_status
    - Job status (enabled, disabled, overdue, etc)
    - Last execution status and time
    - Consecutive failure count
    - Next scheduled run time

Performance Queries:
  â€¢ Failed jobs in last 24 hours
  â€¢ Success rate by job type
  â€¢ Average execution duration
  â€¢ Jobs exceeding failure threshold
  â€¢ Overdue jobs awaiting retry


CURRENT STATE & NEXT STEPS
==========================

âœ“ COMPLETED:
  â€¢ 10 action triggers identified
  â€¢ Logging infrastructure analyzed
  â€¢ Database schema documented
  â€¢ Scheduler architecture understood
  â€¢ Error handling patterns documented

TODO (Recommended):
  1. Create action_logs table
  2. Implement log_action() utility
  3. Integrate at 10 trigger points
  4. Create action logs dashboard
  5. Add action analytics views
  6. Build alert system for failures

DOCUMENTATION:
  âœ“ CODEBASE_ARCHITECTURE.md (detailed)
  âœ“ ACTION_LOGGING_GUIDE.md (quick reference)
  âœ“ ARCHITECTURE_DIAGRAM.txt (visual)

